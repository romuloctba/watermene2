(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const M=171,k=document.querySelector("#transparency"),N=document.querySelector("#width"),V=document.querySelector("#currentSize"),L=document.querySelector("#position-x"),B=document.querySelector("#position-y"),_=document.getElementById("resetButton"),j=document.getElementById("closeMain"),G=document.getElementById("how"),f=document.getElementById("how-form"),F=document.querySelector("#imageInput"),D=document.getElementById("backgroundInput"),i=document.querySelector("#menearea"),p=document.getElementById("the-form"),H=document.getElementById("upload-mene"),T=document.getElementById("reset-container"),K=document.getElementById("download"),Y=document.getElementById("share"),J=document.getElementById("installButton"),E=document.getElementById("installButtonContainer"),Q=document.getElementById("backToSealsButton"),x=document.getElementById("loadingMessage"),h=document.getElementById("instructions-container");function $(){const e=`
    <div class="wordart superhero">
        <div class="logo-ball"></div>
        <h1 class="text">WaterMene</h1>
    </div>
    
    <ol>
        <li>Envie o seu Mene</li>
        <li>Escolha, ou envie, um selo/marca d'água</li>
        <li>Posicione</li>
        <li>Faça download!<span class="news-badge">**</span></li>

        <li class="warning">
            As imagens serão ajustadas para um máximo de 960px de largura.
        </li>
        <li class="warning">
        <br />
        **Atenção: Nem todos os watermenes são compliance com a regras do grupo. Contacte o SAC/Moderação em caso de dúvida.
        </li>

    </ol>
    <div>
    <h3>Ver Código Fonte</h3>
      <a href="https://github.com/romuloctba/watermene2" target="blank">
        <img src="https://camo.githubusercontent.com/1204ee3ae24cd3d431669311f6d03d67ed69da03b2439f22ad4b6247021036d3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f77617465726d656e652d76322d677265656e" alt="WaterMene V2" />
      </a>
    </div>
    
    `;h.innerHTML=e,l(h)}function X(){r(h),h.innerHTML=""}$();const v=document.getElementById("main"),A=document.getElementById("closeMain");function Z(){if(!v.classList.contains("closed")){v.classList.add("closed"),A.classList.add("closed");return}A.classList.remove("closed"),v.classList.remove("closed")}function ee(e){const t=document.querySelector("#how-form .visible");t==null||t.classList.remove("visible"),t==null||t.classList.add("hidden"),console.log("removed"),document.getElementById(e).classList.add("visible"),document.getElementById(e).classList.remove("hidden")}function te(e){const t=e.target;ee(t.value)}function ne(){p.reset(),D.value="",F.value=""}function oe(){ne(),$(),l(H),r(f),r(p),r(T)}function y(e){if(!e.classList.contains("hidden")){r(e);return}l(e)}function l(e){e.classList.remove("hidden")}function r(e){e.classList.add("hidden")}function ae(){oe(),me(),P(),W(0,0)}function se(e){x.innerHTML=`<div class="loadingHeart"><div class="lds-heart"><div></div></div></div> Carregando Selos, aguarde... (#${e}) `}function ce(){r(x)}let S=null,g=M;function q(e){S=e}function re(){return S}function ie(e){const t=re();if(t){const s=parseInt(L.value,10),a=parseInt(B.value,10),o=g,n=g/t.width*t.height,c=parseFloat(k.value||"0.5");e.globalAlpha=c,e.drawImage(t,s,a,o,n),e.globalAlpha=1}}function R(){r(f),l(p)}function de(e){e.preventDefault(),l(f),r(p)}function le(e){const s=e.target.files[0],a=new FileReader;a.onload=function(o){const n=new Image;n.onload=function(){q(n),d()},n.src=o.target.result},a.readAsDataURL(s),R()}function ue(e){q(e),d(),R()}function ge(e){const t=e.target;g=parseInt(t.value,10),V.innerHTML=`${g}px;`,d()}function me(){S=null,g=M}let w=null;function P(e){(e||i.getContext("2d")).clearRect(0,0,i.width,i.height)}function W(e,t){i.width=e,i.height=t}function d(){w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const e=i.getContext("2d");e&&(P(e),ve(e),ie(e))})}function O(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),s=e.toLocaleString("default",{month:"long"}),a=String(e.getFullYear()),o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`mene-${`${t}-${s}-${a}-${o}-${n}`}.png`}function he(){const e=i.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download=O(),document.body.appendChild(t),t.click(),document.body.removeChild(t)}let U=null;function fe(e){U=e}function pe(){return U}function ve(e){const t=pe();if(t){const{width:s,height:a}=z(t);e.drawImage(t,0,0,s,a)}}function z(e){return e.width<=960?{width:e.width,height:e.height}:{width:960,height:960/(e.width/e.height)}}function ye(){X(),y(H),y(T),y(f)}function we(e){const s=e.target.files[0],a=new FileReader;a.onload=o=>{const n=new Image;n.onload=()=>{fe(n);const{width:c,height:m}=z(n);L.setAttribute("max",""+c),B.setAttribute("max",""+m),W(c,m),d()},n.src=o.target.result},a.readAsDataURL(s),ye()}D.addEventListener("change",we);j.addEventListener("click",Z);K.addEventListener("click",he,!1);G.addEventListener("change",te);F.addEventListener("change",le);_.addEventListener("click",ae);N.addEventListener("change",ge);k.addEventListener("input",d);L.addEventListener("input",d);B.addEventListener("input",d);Q.addEventListener("click",de);let u;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),u=e,l(E)});J.addEventListener("click",()=>{u&&(u.prompt(),u.userChoice.then(e=>{e.outcome==="accepted"?console.log("App installed successfully!"):console.log("App installation canceled."),u=void 0,r(E)})),r(E)});const C="data-counter",Ee=document.getElementById("slider"),I=[];async function Ie(){let e=0,t=!1;for(;!t;)se(e),await fetch(`seals/seal_${e}.png`,{method:"HEAD"}).then(s=>{if(s.status===404){t=!0,ce();return}I.push(`${e}`),e++});return Promise.resolve()}Ie().then(()=>{for(let e=0;e<I.length;e++){console.log("creating el ",e);const t=document.createElement("button");t.setAttribute(C,I[e]),t.classList.add("slide"),t.addEventListener("click",function(){const n=this.getElementsByTagName("img")[0];ue(n)});const s=n=>{console.log("intercepted"),setTimeout(()=>{n.forEach(c=>{if(c.isIntersecting){const m=c.target.getAttribute(C),b=document.createElement("img");b.setAttribute("src","seals/seal_"+m+".png"),c.target.appendChild(b),a.unobserve(c.target)}})},750)},a=new IntersectionObserver(s),o=t;a.observe(o),Ee.appendChild(t)}});async function Le(e){if(navigator.canShare(e))try{await navigator.share(e)}catch(t){t.name!=="AbortError"&&console.error(t.name,t.message)}}function Be(){i.toBlob(e=>{if(!e)return;const s={text:"Veja meu Mene",title:"Mene criado com WaterMene V2",files:[new File([e],O(),{type:e.type})]};Le(s).then(a=>{console.log("shared",a)})})}Y.addEventListener("click",Be);
