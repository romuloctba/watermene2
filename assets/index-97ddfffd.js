(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const C=88,k=document.querySelector("#transparency"),L=document.querySelector("#position-x"),w=document.querySelector("#position-y"),N=document.getElementById("resetButton"),_=document.getElementById("sizeSelect"),$=document.getElementById("closeMain"),W=document.getElementById("how"),f=document.getElementById("how-form"),M=document.querySelector("#imageInput"),T=document.getElementById("backgroundInput"),r=document.querySelector("#menearea"),p=document.getElementById("the-form"),F=document.getElementById("upload-mene"),H=document.getElementById("reset-container"),G=document.getElementById("download"),K=document.getElementById("installButton"),I=document.getElementById("installButtonContainer"),V=document.getElementById("backToSealsButton"),x=document.getElementById("loadingMessage"),g=document.getElementById("instructions-container");function D(){const e=`
    <div class="wordart superhero">
        <div class="logo-ball"></div>
        <h1 class="text">WaterMene</h1>
    </div>
    
    <ol>
        <li>Envie o Mene para adicionar o selo.</li>
        <li>Escolha entre os selos disponíveis, ou envie o seu próprio selo.</li>
        <li>Posicione, escolha o tamanho, e altere a transparência.</li>
        <li>Faça download do seu Mene finalizado<span class="news-badge">**</span></li>

        <li class="warning">
        **Atenção: Nem todos os watermenes são compliance com a regras do grupo. Contacte o SAC/Moderação em caso de dúvida.
        </li>
    </ol>
    
    `;g.innerHTML=e,l(g)}function j(){i(g),g.innerHTML=""}D();const h=document.getElementById("main"),S=document.getElementById("closeMain");function J(){if(!h.classList.contains("closed")){h.classList.add("closed"),S.classList.add("closed");return}S.classList.remove("closed"),h.classList.remove("closed")}function Q(e){const t=document.querySelector("#how-form .visible");t==null||t.classList.remove("visible"),t==null||t.classList.add("hidden"),console.log("removed"),document.getElementById(e).classList.add("visible"),document.getElementById(e).classList.remove("hidden")}function X(e){const t=e.target;Q(t.value)}function Y(){p.reset(),T.value="",M.value=""}function Z(){Y(),D(),l(F),i(f),i(p),i(H)}function v(e){if(!e.classList.contains("hidden")){i(e);return}l(e)}function l(e){e.classList.remove("hidden")}function i(e){e.classList.add("hidden")}function ee(){Z(),de(),R(),O(0,0)}function te(e){x.innerHTML=`<div class="loadingHeart"><div class="lds-heart"><div></div></div></div> Carregando Selos, aguarde... (#${e}) `}function ne(){i(x)}let B=null,m=C;function q(e){B=e}function oe(){return B}function se(e){const t=oe();if(t){const a=parseInt(L.value,10),s=parseInt(w.value,10),o=m,n=m/t.width*t.height,c=parseFloat(k.value||"0.5");e.globalAlpha=c,e.drawImage(t,a,s,o,n),e.globalAlpha=1}}function P(){i(f),l(p)}function ae(e){e.preventDefault(),l(f),i(p)}function ce(e){const a=e.target.files[0],s=new FileReader;s.onload=function(o){const n=new Image;n.onload=function(){q(n),d()},n.src=o.target.result},s.readAsDataURL(a),P()}function ie(e){q(e),d(),P()}function re(e){const t=e.target;m=parseInt(t.value,10),d()}function de(){B=null,m=C}let y=null;function R(e){(e||r.getContext("2d")).clearRect(0,0,r.width,r.height)}function O(e,t){r.width=e,r.height=t}function d(){y!==null&&cancelAnimationFrame(y),y=requestAnimationFrame(()=>{const e=r.getContext("2d");e&&(R(e),me(e),se(e))})}function le(){const e=r.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="watermene.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}let U=null;function ue(e){U=e}function ge(){return U}function me(e){const t=ge();t&&e.drawImage(t,0,0)}function fe(){j(),v(F),v(H),v(f)}function pe(e){const a=e.target.files[0],s=new FileReader;s.onload=o=>{const n=new Image;n.onload=()=>{ue(n),L.setAttribute("max",""+n.width),w.setAttribute("max",""+n.height),O(n.width,n.height),d()},n.src=o.target.result},s.readAsDataURL(a),fe()}T.addEventListener("change",pe);$.addEventListener("click",J);G.addEventListener("click",le,!1);W.addEventListener("change",X);M.addEventListener("change",ce);N.addEventListener("click",ee);_.addEventListener("change",re);k.addEventListener("input",d);L.addEventListener("input",d);w.addEventListener("input",d);V.addEventListener("click",ae);let u;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),u=e,l(I)});K.addEventListener("click",()=>{u&&(u.prompt(),u.userChoice.then(e=>{e.outcome==="accepted"?console.log("App installed successfully!"):console.log("App installation canceled."),u=void 0,i(I)})),i(I)});const A="data-counter",he=document.getElementById("slider"),E=[];async function ve(){let e=0,t=!1;for(;!t;)te(e),await fetch(`seals/seal_${e}.png`,{method:"HEAD"}).then(a=>{if(a.status===404){t=!0,ne();return}E.push(`${e}`),e++});return Promise.resolve()}ve().then(()=>{for(let e=0;e<E.length;e++){console.log("creating el ",e);const t=document.createElement("button");t.setAttribute(A,E[e]),t.classList.add("slide"),t.addEventListener("click",function(){const n=this.getElementsByTagName("img")[0];ie(n)});const a=n=>{console.log("intercepted"),setTimeout(()=>{n.forEach(c=>{if(c.isIntersecting){const z=c.target.getAttribute(A),b=document.createElement("img");b.setAttribute("src","seals/seal_"+z+".png"),c.target.appendChild(b),s.unobserve(c.target)}})},750)},s=new IntersectionObserver(a),o=t;s.observe(o),he.appendChild(t)}});
