(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const C=88,k=document.querySelector("#transparency"),w=document.querySelector("#position-x"),L=document.querySelector("#position-y"),z=document.getElementById("resetButton"),N=document.getElementById("sizeSelect"),_=document.getElementById("closeMain"),$=document.getElementById("how"),f=document.getElementById("how-form"),F=document.querySelector("#imageInput"),M=document.getElementById("backgroundInput"),r=document.querySelector("#menearea"),p=document.getElementById("the-form"),T=document.getElementById("upload-mene"),x=document.getElementById("reset-container"),W=document.getElementById("download"),G=document.getElementById("installButton"),I=document.getElementById("installButtonContainer"),K=document.getElementById("backToSealsButton"),m=document.getElementById("instructions-container");function q(){const e=`
    <div class="wordart superhero">
        <div class="logo-ball"></div>
        <h1 class="text">WaterMene</h1>
    </div>
    
    <ol>
        <li>Envie o Mene para adicionar o selo.</li>
        <li>Escolha entre os selos disponíveis<span class="news-badge">*</span> ou envie o seu próprio selo.</li>
        <li>Posicione, escolha o tamanho, e altere a transparência.</li>
        <li>Faça download do seu Mene finalizado<span class="news-badge">**</span></li>
        <li class="warning">
            *Em breve
        </li>
        <li class="warning">
        **Atenção: Nem todos os watermenes são compliance com a regras do grupo. Contacte o SAC/Moderação em caso de dúvida.
        </li>
    </ol>
    
    `;m.innerHTML=e,d(m)}function V(){i(m),m.innerHTML=""}q();const h=document.getElementById("main"),S=document.getElementById("closeMain");function j(){if(!h.classList.contains("closed")){h.classList.add("closed"),S.classList.add("closed");return}S.classList.remove("closed"),h.classList.remove("closed")}function J(e){const t=document.querySelector("#how-form .visible");t==null||t.classList.remove("visible"),t==null||t.classList.add("hidden"),console.log("removed"),document.getElementById(e).classList.add("visible"),document.getElementById(e).classList.remove("hidden")}function Q(e){const t=e.target;J(t.value)}function X(){p.reset(),M.value="",F.value=""}function Y(){X(),q(),d(T),i(f),i(p),i(x)}function v(e){if(!e.classList.contains("hidden")){i(e);return}d(e)}function d(e){e.classList.remove("hidden")}function i(e){e.classList.add("hidden")}function Z(){Y(),ce(),P(),R(0,0)}let B=null,g=C;function D(e){B=e}function ee(){return B}function te(e){const t=ee();if(t){const a=parseInt(w.value,10),s=parseInt(L.value,10),o=g,n=g/t.width*t.height,c=parseFloat(k.value||"0.5");e.globalAlpha=c,e.drawImage(t,a,s,o,n),e.globalAlpha=1}}function H(){i(f),d(p)}function ne(e){e.preventDefault(),d(f),i(p)}function oe(e){const a=e.target.files[0],s=new FileReader;s.onload=function(o){const n=new Image;n.onload=function(){D(n),l()},n.src=o.target.result},s.readAsDataURL(a),H()}function se(e){D(e),l(),H()}function ae(e){const t=e.target;g=parseInt(t.value,10),l()}function ce(){B=null,g=C}let y=null;function P(e){(e||r.getContext("2d")).clearRect(0,0,r.width,r.height)}function R(e,t){r.width=e,r.height=t}function l(){y!==null&&cancelAnimationFrame(y),y=requestAnimationFrame(()=>{const e=r.getContext("2d");e&&(P(e),de(e),te(e))})}function ie(){const e=r.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="watermene.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}let O=null;function re(e){O=e}function le(){return O}function de(e){const t=le();t&&e.drawImage(t,0,0)}function ue(){V(),v(T),v(x),v(f)}function me(e){const a=e.target.files[0],s=new FileReader;s.onload=o=>{const n=new Image;n.onload=()=>{re(n),w.setAttribute("max",""+n.width),L.setAttribute("max",""+n.height),R(n.width,n.height),l()},n.src=o.target.result},s.readAsDataURL(a),ue()}M.addEventListener("change",me);_.addEventListener("click",j);W.addEventListener("click",ie,!1);$.addEventListener("change",Q);F.addEventListener("change",oe);z.addEventListener("click",Z);N.addEventListener("change",ae);k.addEventListener("input",l);w.addEventListener("input",l);L.addEventListener("input",l);K.addEventListener("click",ne);let u;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),u=e,d(I)});G.addEventListener("click",()=>{u&&(u.prompt(),u.userChoice.then(e=>{e.outcome==="accepted"?console.log("App installed successfully!"):console.log("App installation canceled."),u=void 0,i(I)})),i(I)});const A="data-counter",ge=document.getElementById("slider"),E=[];async function fe(){let e=0,t=!1;for(;!t;)await fetch(`/seals/seal_${e}.png`).then(a=>{if(a.status===404){t=!0;return}console.log("loaded seal ",e),E.push(`${e}`),e++});return Promise.resolve()}fe().then(()=>{for(let e=0;e<E.length;e++){console.log("creating el ",e);const t=document.createElement("button");t.setAttribute(A,E[e]),t.classList.add("slide"),t.addEventListener("click",function(){const n=this.getElementsByTagName("img")[0];se(n)});const a=n=>{console.log("intercepted"),setTimeout(()=>{n.forEach(c=>{if(c.isIntersecting){const U=c.target.getAttribute(A),b=document.createElement("img");b.setAttribute("src","/seals/seal_"+U+".png"),c.target.appendChild(b),s.unobserve(c.target)}})},750)},s=new IntersectionObserver(a),o=t;s.observe(o),ge.appendChild(t)}});
